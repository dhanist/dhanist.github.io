<!DOCTYPE html>
<html lang="id">
  <head>
        <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=endge, chrome=IE8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />
    <title>Jaringan Layer 3, IP routing — DevNull</title>
    <!--[if lte IE 8]><script type="text/javascript" src="//devnull.web.id/theme/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" type="text/css" href="//devnull.web.id/theme/css/skeleton.css" />
    <link href='https://fonts.googleapis.com/css?family=Lato:400,400italic,700,700italic|Open+Sans:400italic,400,700,700italic' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" type="text/css" href="//devnull.web.id/theme/css/theme.css" />
    <link rel="stylesheet" type="text/css" href="//devnull.web.id/theme/css/pastie.css" />
<!--    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,700italic,400italic,300,300italic' rel='stylesheet' type='text/css' /> -->
    <link rel="shortcut icon" type="image/png" href="//devnull.web.id/favicon.png" />
    <!--[if lte IE 8]><link rel="shortcut icon" type="image/x-icon" href="//devnull.web.id/favicon.ico" /><![endif]-->
    <link rel="alternate" type="application/atom+xml"
                           title="DevNull — Flux Atom"
                           href="http://feeds.feedburner.com/blog/devnull" /> 

    <meta name="author"   content="Dhani Setiawan" />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="page">
      <header id="page-head">
        <h1>
          <a href="//devnull.web.id/index.html">DevNull</a>
        </h1>
      </header>
      
      <div id="page-body">
        <article class="post" id="page-main" role="main">
      <header class="post-header">
        <h1>
          <a rel="bookmark"
             href="//devnull.web.id/networking/jaringan-layer-3.html"
             title="Bookmarks «Jaringan Layer 3, IP routing»">
             Jaringan Layer 3, IP routing
          </a>
        </h1>
        <div class="meta">
<!-- includes/article_meta.html -->
            Published by <a href="//devnull.web.id/author/dhani-setiawan.html">Dhani Setiawan</a>
            on <time datetime="2019-12-01T09:45:00+08:00">Sun 01 December 2019</time>
            <br />Filed under: <a href="//devnull.web.id/category/networking.html">Networking</a>        </div>
      </header>
      <div class="post-content"> 
        <p>Selamat datang teman-teman pembaca. Saya meneruskan tulisan yang lama tentang
jaringan layer 1, 2, dan 3. Saya lihat demand tulisan itu lumayan bagus, jadi
saya terpikir buat sedikit lebih dalam membahas apa yang terjadi di layer 3.</p>
<p>Layer 3 ini di standar OSI dinamakan network layer dan di layer ini ada beberapa
protokol yang berjalan, salah satunya yang paling populer dan hanya
itu yang akan saya bahas, yaitu IP atau Internet Protocol. IP ini yang sekarang
kita pakai buat akses web, sosial media, email, dll.</p>
<p>Sebelum kita bahas IP dan proses routing-nya, saya mau kita samakan persepsi
dulu tentang IP supaya tidak membingungkan. Jadi kalau saya sebut IP, yang saya
maksud bukan seperti 192.168.1.1, ini bukan IP, tapi ini alamat IP atau IP address.</p>
<p>Jadi apa itu IP?<br />
IP atau Internet Protocol bisa kita bayangkan seperti Bahasa
Indonesia, satu bahasa yang dimengerti semua suku di Indonesia, kecuali mungkin
yang di pedalaman. Itulah IP, satu bahasa atau protokol yang dimengerti semua
perangkat layer 3 apapun jenis dan merek nya. Smartphone, PC, Laptop, server dan
router yang jenis dan mereknya berbeda-beda itu, tapi mereka semua mengerti satu
bahasa, bahasa IP.</p>
<p>Kemudian di dalam IP ini ada yang namanya alamat IP dan paket IP. Alamat IP,
sama seperti alamat pada umumnya, ini informasi di mana perangkat IP
ini lokasinya, tidak ditulis dengan nama jalan tapi pakai notasi
192.168.1.100 misalnya.</p>
<p>Paket IP, sama seperti paket umumnya, ada
alamat IP pengirim, ada alamat IP penerima, ada isi paket yang dalam
bahasa IP disebut Payload. Payload ini bisa berisi data TCP misalnya,
yang kalau kita akses web atau email kita pakai TCP.
Payload bisa juga berisi UDP yang kalau kita request DNS pakai UDP.
Bisa juga berisi ICMP yang biasanya kita kirim pakai program PING.
Atau bahkan IP payload ini bisa berisi paket IP, IP dalam IP yang biasa disebut
IP tunnel.</p>
<p>&nbsp;</p>
<h2 id="proses-routing-ip">Proses routing IP</h2>
<p>Nah sekarang, setelah paham apa itu IP, kita bahas masalah routing IP.  Apa itu?
proses routing IP ini, cara bagaimana satu paket IP dari alamat pengirim bisa
sampai di alamat IP penerima, melewati beberapa atau banyak IP forwarder yang
disebut router.</p>
<p>Router-router ini bertugas menerima paket dari pengirim atau
dari router lainnya, kemudian meneruskan ke router lain atau menyerahkan paket
IP tersebut ke penerima kalau dia yang terhubung ke alamat penerima atau dia router
yang terakhir. Bayangkan pengiriman paket lewat jasa ekspedisi yang melewati
beberapa pos transit sebelum sampai ke penerima, pos-pos ini fungsinya sama
dengan router.</p>
<p>Kemudian bagaimana cara sebuah router menentukan jalur yang harus dilewati
paket IP? seperti sebuah rumah yang punya beberapa pintu, paket IP ke tujuan
tertentu harus lewat pintu mana? salah jalur maka paket tidak bisa sampai
tujuan.</p>
<p>Di sinilah peran routing protocol, routing protocol menentukan jalur A
untuk tujuan alamat IP A, dan jalur B untuk tujuan B, dst. Dan setelah
diputuskan jalurnya, informasi ini dicatat di sebuah database yang disebut
routing table atau <em>routing information base (RIB)</em>. Ya, jadi masing-masing router
punya data informasi routing table, jadi waktu ada paket masuk, dilihat
tujuannya dan alamat tujuan ini dicari di data routing table dan setelah didapat
jalurnya, paket IP diteruskan lewat jalur itu.</p>
<p>&nbsp;</p>
<h2 id="routing-protocol">Routing Protocol</h2>
<p>Secara garis besar, routing protocol dibagi jadi tiga. <em>Link</em> atau <em>Connected</em>,
<em>static routing</em>, dan <em>dynamic routing</em>. Kita bahas satu-satu.</p>
<h4 id="connected-link">Connected / Link.</h4>
<p>Link atau juga disebut connected routing, ini informasi router dalam satu
broadcast domain.
Informasi routing yang otomatis terbuat kalau kita assign ip address di
interface router. Misal router A punya 2 interface, eth0 dan eth1. Kita
set ip address 192.168.1.1/24 di eth0, maka secara otomatis router akan
membuat informasi routing bahwa network 192.168.1.0/24 lewat eth0.
Informasi ini kemudian disimpan di data routing table.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">[root: ~] Endor #</span> ip route
<span class="go">default via 10.10.10.28 dev eth0</span>
<span class="go">10.10.10.0/24 dev eth0 proto kernel scope link src 10.10.10.96</span>
<span class="gp">[root: ~] Endor #</span> ip addr add <span class="m">192</span>.168.1.1/24 dev eth0
<span class="gp">[root: ~] Endor #</span> ip route
<span class="go">default via 10.10.10.28 dev eth0</span>
<span class="go">10.10.10.0/24 dev eth0 proto kernel scope link src 10.10.10.96</span>
<span class="go">192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.1</span>
<span class="gp">[root: ~] Endor #</span>
</code></pre></div>


<p>Seperti terlihat di atas, routing 192.168.1.0/24 otomatis terbuat waktu saya set
ip address 192.168.1.1/24 di interface eth0.</p>
<p>&nbsp;</p>
<h4 id="static-routing-protocol">Static routing protocol</h4>
<p>Static routing protocol. Protokol ini diset secara manual oleh administrator
jaringan. Jadi misal saya mau informasikan ke router A di atas bahwa tujuan
alamat 172.16.1.0/24 lewat 192.168.1.100, maka saya harus secara manual inputkan
data ini ke router, baru kemudian router tulis data ini ke routing table. Maka
ketika ada paket masuk router A dengan tujuan 172.16.1.1 misalnya, router A cek
routing table dan ternyata 172.16.1.1 masuk ke network 172.16.1.0/24.</p>
<p>Berdasarkan informasi routing table bahwa 172.16.1.0/24 harus lewat
192.168.1.100, maka paket ini akan diteruskan ke 192.168.1.100.<br />
Tapi di mana router 192.168.1.100 ini? sekali lagi router A cek routing
table dan didapat bahwa 192.168.1.100 masuk network 192.168.1.0/24 dan
192.168.1.0/24 lewat interface eth0.</p>
<p>Dan itulah yang terjadi, paket dengan
tujuan 172.16.1.1 diteruskan ke 192.168.1.100 lewat interface eth0.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">[root: ~] Endor #</span> ip route show
<span class="go">default via 10.10.10.28 dev eth0</span>
<span class="go">10.10.10.0/24 dev eth0 proto kernel scope link src 10.10.10.96</span>
<span class="go">192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.1</span>
<span class="gp">[root: ~] Endor #</span>
<span class="gp">[root: ~] Endor #</span> ip route add <span class="m">172</span>.16.1.0/24 via <span class="m">192</span>.168.1.100
<span class="gp">[root: ~] Endor #</span>
<span class="gp">[root: ~] Endor #</span> ip route show
<span class="go">default via 10.10.10.28 dev eth0</span>
<span class="go">10.10.10.0/24 dev eth0 proto kernel scope link src 10.10.10.96</span>
<span class="go">172.16.1.0/24 via 192.168.1.100 dev eth0</span>
<span class="go">192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.1</span>
<span class="gp">[root: ~] Endor #</span>
</code></pre></div>


<p>Satu, dua, atau sepuluh informasi routing masih oke, tapi bagaimana kalau saya
punya ratusan atau bahkan ribuan network yang melibatkan banyak sekali router?
di sinilah peran dynamic routing protocol.</p>
<p>&nbsp;</p>
<h4 id="dynamic-routing-protocol">Dynamic Routing Protocol</h4>
<p>Dynamic routing ini protokol routing yang kita tidak perlu input satu-satu
entri routing secara manual. Misal saya punya 100 router yang saling
terhubung, saya input routing di router ke 100, maka secara otomatis 99 router
yang lainnya akan meng-update data routing table mereka tanpa intervensi manual.</p>
<p>Di sini saya bahas 2 saja untuk dynamic routing, <strong>Border gateway protocol (BGP)</strong>
dan <strong>Open Shortest Path First (OSPF)</strong>. Dua protokol ini yang paling banyak
dipakai di jaringan yang besar. BGP dan OSPF akan kita bahas nanti.</p>
<p>Dynamic routing protocol, seperti yang sudah disebutkan, dia didesain buat
memudahkan administrasi routing. Pakai dynamic protocol, admin jaringan bisa
me-manage banyak sekali router tanpa takut looping.</p>
<p>Routing loop ini misalnya router A mengatakan tujuan C harus lewat router B,
sementara router B mengatakan tujuan C harus lewat router A. Jadinya paket IP
ke C cuma bolak balik antara router A sama B, tidak bisa sampai C.</p>
<p>Looping ini sangat mungkin dan umum terjadi di jaringan yang pakai static routing, karena
admin yang salah setting static route. Nah dynamic routing menjamin routing
yang bebas loop, biarpun banyak sekali router yang terlibat di jaringan.</p>
<p>&nbsp;</p>
<h2 id="administrative-distance-ad">Administrative Distance (AD)</h2>
<p>Di satu router, bisa saja ada beberapa routing protocol yang jalan, tapi entri
di routing table cuma ada satu yang bisa aktif dan inilah yang jadi rujukan
router buat memproses pengiriman paket IP. Maksudnya begini, kalau misalnya ada
dua atau lebih routing protokol menulis ke routing table untuk tujuan yang sama,
misal saja ada connected untuk tujuan 10.10.10.0/24 lewat eth0, ada juga routing
yang sama dari protokol static untuk route 10.10.10.0/24.</p>
<p>Nah di routing table bakal ada dua entri untuk route yang sama, 10.10.10.0/24.
Tapi yang aktif cuma bisa satu, dan penentuan jalur ini berdasarkan rangking
yang disebut <em>administrative distance</em>, semakin kecil nilai distance, dia yang
akan dipilih.</p>
<p>Pengecualian buat <em>Equal Cost Multipath</em> atau <strong>ECMP</strong> dimana beberapa jalur bisa aktif
bersamaan, tapi ini teknik yang agak advance.</p>
<p>Secara default distance untuk masing-masing protokol:</p>
<ul>
<li><strong>Connected / Link  : 0</strong></li>
<li><strong>Static            : 1</strong> dan bisa diset di angka lain sesuka hati admin. Misal
                        supaya routing table memprioritaskan ospf daripada yang static ini, nilai
                        distance harus lebih besar dari ospf yang angkanya 110.</li>
<li><strong>OSPF              : 110</strong></li>
<li><strong>BGP               : 200</strong> untuk internal bgp (ibgp) dan <strong>20</strong> untuk external bgp
(ebgp)</li>
</ul>
<div class="aimg">
    <img src="//devnull.web.id/images/networking/ip_route/rib.png" alt="Routing table" title="Routing Table" />
</div>

<p>&nbsp;</p>
<p>Baik teman-teman, di atas tadi gambaran tentang bagaimana proses routing dan
routing protocol.</p>
<p>Di bawah saya coba bahas dua routing protokol yang termasuk dynamic routing,
BGP sama OSPF.</p>
<p>&nbsp;</p>
<h3 id="bgp-border-gateway-protocol">BGP (Border Gateway Protocol)</h3>
<p>BGP ini protokol yang sekarang dipakai backbone Internet, jadi penyedia jasa
semacam isp atau nap, termasuk juga institusi seperti kampus yang berbeda-beda
semua terhubung lewat bgp. Masing-masing bgp dari router yang berbeda
saling bertukar informasi tentang jaringan masing-masing.</p>
<p>Silakan coba cek looking glass OpenIXP di <a href="http://lg.mohonmaaf.com">http://lg.mohonmaaf.com</a>, pilih show ip
bgp summary dan submit.</p>
<p>Ada ratusan bgp dari perusahaan dan institusi yang bermacam-macam saling
terkoneksi di sini.</p>
<p>Dari output looking glass ini ada beberapa informasi yang perlu dicatat; <em>Neighbor</em>,
<em>AS</em>, sama <em>State/Pfx</em>. Satu-satu dijelaskan di bawah:</p>
<p><strong>Neighbor.</strong> Ini alamat IP router bgp yang ada di satu broadcast domain.
Misal Indosat di OpenIXP beralamat IP di 218.100.36.110 dan
Telkom di 218.100.36.59.</p>
<p>Jadi misal dari Indosat menuju Telkom kalau di OpenIXP berarti lewat
218.100.36.59, begitu juga sebaliknya menuju Indosat lewat 218.100.36.110.</p>
<p><strong>AS (Autonomous System)</strong> AS ini representasi perusahaan, institusi atau organisasi.
Jadi ada AS Telkom, AS Indosat, AS Telkomsel, dan seterusnya.
Nah masing masing AS ini punya nomor yang disebut <strong>ASN</strong> atau <em>Autonomous System Number</em>.</p>
<p>Nomor AS atau ASN ini sifatnya publik juga unik, tidak ada nomor ASN yang sama.
Pengalokasian ASN ini di bawah IANA atau Internet Assigned Numbers Authority.
Artinya setiap perusahaan atau institusi harus daftar kalau mau punya nomor AS.</p>
<p>Karena AS ini informasi publik, siapa saja bisa lihat. Kalau teman-teman mau cek
misalnya BGP Telkom, Telkom punya ASN salah satunya 7713, silakan cek BGP Telkom
terkoneksi kemana saja, bisa lewat <a href="https://bgp.he.net/AS7713">https://bgp.he.net/AS7713</a></p>
<p>Peering bgp ini bisa antar AS artinya ASN nya beda nomor, bisa juga dalam satu
autonomous system atau nomor AS nya sama. Peer bgp antar AS disebut <em>external bgp</em>
atau <strong>ebgp</strong>, sementara peer bgp dalam satu AS namanya <em>internal bgp</em> atau
<strong>ibgp</strong>.</p>
<p><strong>State/Pfx.</strong> Ada dua informasi di sini, state sama Prefix.
State ini kondisi koneksi bgp, dia bisa open, connect, atau established.</p>
<p>Prefix, ini jumlah prefix yang diterima dari neighbor.<br />
Terus prefix ini apa? Prefix ini alamat network, seperti 192.168.0.0/24 misalnya.
Nah berarti jumlah prefix yang diterima dari neighbor ini berarti jumlah
network yang diumumkan oleh neighbor atau peer itu.</p>
<p>Misalkan Telkom yang punya ASN 7713 mengumumkan ke OpenIXP lewat
routernya 218.100.36.59 kalau ada sebanyak 2000 network yang kalau mau menuju
network ini bisa lewat router Telkom.</p>
<p>Kalau mau tau networknya apa saja, bisa cek di <a href="http://lg.mohonmaaf.com">http://lg.mohonmaaf.com</a> pilih
<code>show ip bgp neighbor 218.100.x.x received-routes</code>, isikan neighbor Telkom
218.100.36.59 di kolom isian, klik submit.</p>
<p>Prefix ini yang ada di bgp semuanya publik, kalau kita cari prefix private
seperti 192.168.1.0/24 tidak ada di sini. Juga netmask yang lebih besar dari 24
juga tidak ada, tidak ada /25, /26 dst. Seperti ASN yang publik dan unik,
prefix IP address juga diatur IANA.</p>
<p>Kembali ke hasil looking glass sebelumnya yang received-routes. Di belakang itu
ada informasi path, oke artinya? Ini artinya kalau mau menuju prefix tertentu
jalurnya lewat AS ini.</p>
<p>Dari sini kita tau ternyata yang diumumkan Telkom ke OpenIXP atau dalam
istilah bgp namanya advertise, bukan cuma perfix Telkom, ternyata ada prefix
dari AS lain.</p>
<p>Kenapa begitu? Ini mungkin pelanggan Telkom yang ada di daerah yang mereka tidak
terkoneksi langsung ke OpenIXP karena OpenIXP adanya di gedung IDC Jakarta.
Jadi para member OpenIXP kalau mau menuju alamat ini bisa lewat Telkom.</p>
<p>Terus bagaimana misalnya pelanggan Telkom ini juga jadi pelanggan Indosat, yang
Indosat juga ada di OpenIXP, terus masing-masing Indosat sama Telkom advertise
prefix pelanggan ini ke OpenIXP.</p>
<p>Maka di OpenIXP bakal ada dua jalur menuju prefix yang sama, tapi cuma satu
yang bisa aktif.
Yang mana yang jadi aktif kalau begitu? Em.. di bgp ada flag namanya localpref
yang bisa diset secara manual oleh admin bgp, semakin tinggi nilai localpref
maka dia yang bakal dipilih.</p>
<p>Tapi secara default localpref untuk bgp sama semua bobotnya, kalau begitu bgp bakal pilih
yang jalur AS path nya yang paling pendek. Artinya kalau misalnya lewat Telkom
lewat 3 AS sementara Indosat cuma 2 AS, maka Indosat yang aktif.</p>
<p>Coba sekarang kita cek untuk prefix 175.184.248.0/24 di OpenIXP. Buka lagi
<a href="http://lg.mohonmaaf.com">http://lg.mohonmaaf.com</a>, pilih show ip bgp, isikan 175.184.248.0, klik submit,
hasilnya ada di paling bawah.</p>
<p>Dari sini ternyata ada 3 jalur menuju prefix 175.184.248.0/24.
kita juga tau prefix ini terdaftar untuk AS 46028.
Dari 3 jalur yang ada ini yang aktif yang ada kata Best, dan jalur ini dipilih karena
jalur AS atau AS Path nya yang paling pendek, ini karena nilai localpref untuk
tiga path ini semuanya sama.</p>
<p>Ada yang menarik dari salah satu hasil AS path, waktu ini ditulis dan kalau
belum berubah, ada yang AS path nya 17922 46028 46028 46028, AS 17922 AS nya
Indosat.</p>
<p>Apa ini, kenapa AS 46028 diulang tiga kali? Ini artinya kalau mau
menuju prefix 175.184.248.0/22 harus melalui pertama AS Indosat, kemudian 46028,
46028 lagi, baru terakhir 46028 juga.</p>
<p>Sebenarnya AS path nya cuma dua saja, 17922 sama 46028.
Metode ini di BGP namanya AS path prepending, path prepending ini cara membuat
bagaimana seolah-olah jalur as path nya kelihatan panjang ada empat AS,
padahal cuma dua.</p>
<p>Kemudian as path prepend ini yang set dari admin bgp nya AS 46028,
bukan Indosat bukan juga OpenIXP. Nah Karena as path nya kelihatan
panjang di OpenIXP, jalur ini tidak terpilih.</p>
<p>Jadi misalnya kita punya dua atau lebih koneksi bgp, dalam istilah bgp namanya
<em>multihoming</em>, kita bisa misalnya atur bagaimana caranya salah satu jalur kelihatan
panjang pakai as path prepend, yang harapannya jalur yang di prepend ini nanti
tidak terpilih di bgp.</p>
<p>Kita cuma berharap karena panjang as path ini pertimbangan kedua
setelah localpref, jadi kalau kita sudah prepend sampai panjang sepuluh
AS tapi ternyata tetangga bgp kita set localpref maka as path prepend ini
tidak ada gunanya. Tapi dalam kasus OpenIXP ini as path prepend berhasil
karena nilai localpref sama bobotnya.</p>
<p>Terakhir masalah BGP, semua yang dibahas di atas itu bgp publik.
BGP juga ada private bgp, yang bisa dipakai siapa saja
tanpa harus punya nomor AS. ASN atau nomor AS private yang dialokasikan IANA
dari 64512 sampai 65534. ASN ini bisa dipakai siapa saja di jaringan internal,
tidak ada batasan prefix harus publik, juga tidak ada batasan netmask harus
24 atau di bawahnya, bebas.</p>
<p>&nbsp;</p>
<h3 id="konfigurasi-bgp">Konfigurasi BGP</h3>
<p>Baik sekarang setelah sedikit paham tentang gambaran BGP, kita coba detail
teknisnya.</p>
<p>Ada tiga mode konfigurasi BGP yang bisa dipakai, <em>full mesh</em>, <em>route reflect</em>, sama
<em>route server</em>.</p>
<p>Anggap sekarang ini kita punya tiga router yang terkoneksi di satu broadcast
domain, router A, B, dan C.</p>
<div class="aimg">
    <img src="//devnull.web.id/images/networking/ip_route/full_mesh.png" alt="BGP Full mesh" title="BGP Full mesh" />
</div>

<p><strong>Full mesh.</strong> Pakai full mesh, setiap router peering bgp ke semua router, misal A
peer ke B sama C. Router B peering ke A sama C, C peering ke B sama A.</p>
<p>Dengan begini, kalau misalnya link dari A ke B terputus, maka A ke B bisa lewat
router C.
Mode full mesh ini ada kelamahannya, apa itu? Ribet. Bagaimana kalau ada sepuluh
router? masing-masing router punya sembilan peer, dan kalau ada nambah satu
router lagi, kita harus tambah konfigurasi di sepuluh router yang eksisting.</p>
<p><strong>Route reflector.</strong> Mode ini menyederhanakan problem full mesh di atas. Kalau kita
punya banyak router di satu broadcast domain, kita bisa pilih salah satu router
jadi route reflector. Router yang lainnya, semuanya peering ke route reflector.
Jadi di masing-masing route reflector client cuma ada satu peer bgp, ke route
reflector.</p>
<div class="aimg">
    <img src="//devnull.web.id/images/networking/ip_route/route_reflect.png" alt="BGP Route reflector" title="BGP Route reflector" />
</div>

<p>Anggap router yang dijadikan route reflector ini seperti cermin, jadi prefix
yang di advertise dari client akan di reflect atau dipantulkan ke client yang
lain.</p>
<p>Kelemahannya, route reflector jadi <strong>spof</strong> atau <em>single point of failure</em>. Route
reflector mati, maka semua peer bgp mati. Untuk meminimalisir ini, kita bisa
misalnya buat dua route reflector sebagai backup kalau yang utama bermasalah.
Route reflector ini ekstensi iBGP atau internal BGP.</p>
<p><strong>Route server.</strong> Route server sama seperti route reflector, jadi ada satu atau
lebih yang jadi bgp server, semua router peering ke route server. Bedanya sama
route reflector, route server beroperasi di external bgp dan biasa dipakai di
exchange point.</p>
<p>Route server ini tugasnya cuma jadi server, tidak mem-forward traffic IP seperti
router lainnya. Bahkan biasanya hardware yang dipakai juga server Linux yang
diinstall software BGP semacam BIRD atau Quagga.</p>
<p>Banyak route server publik yang bisa teman-teman coba akses di luar sana,
biasanya dipakai buat troubleshooting masalah inbound route, coba cek
<a href="http://www.routeservers.org">http://www.routeservers.org</a></p>
<p>&nbsp;</p>
<p>Oke, kita coba config bgp. Apa yang diperlukan buat setting BGP? kita harus punya:</p>
<ol>
<li>IP address, IP address harus dalam satu broadcast domain.
   Di contoh ini address kita 172.16.3.2/30 sementara address peer kita 172.16.3.1.</li>
<li>AS number kita yang disebut local AS. Di sini kita pakai 64512, private ASN.</li>
<li>AS number peer atau neighbor yang disebut remote AS. Remote AS, atau AS
   tetangga BGP kita 65000 yang juga private.</li>
<li>Prefix apa saja yang mau kita umumkan atau advertise ke peer. Kita punya dua
   prefix, 10.10.10.0/24 sama 192.168.1.0/24. Dua prefix ini yang nantinya kita
   advertise ke neighbor dan dua prefix ini tipenya connected. Masih ingat
   protokol connected di atas?</li>
<li>Prefix yang kita terima dari neighboor atau peer, yang ini optional.</li>
</ol>
<p>Command konfigurasi yang dipakai di sini pakai VyOS, sistem operasi
router yang Open Source. Kompatibel sama Vyatta, atau mungkin juga Juniper
JunOS.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2:~$ #</span> masuk mode konfiugrasi pakai <span class="nb">command</span> configure
<span class="gp">vyos@ROUTER2:~$</span> configure
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> <span class="nb">set</span> IP address, contoh saja di eth0
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> interfaces ethernet eth0 address <span class="m">172</span>.16.3.2/30
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> commit dulu supaya ip address terset di eth0
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> kemudian <span class="nb">set</span> <span class="nb">local</span> AS <span class="m">64512</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols bgp <span class="m">64512</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> kemudian <span class="nb">set</span> alamat neighbor
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols bgp <span class="m">64512</span> neighbor <span class="m">172</span>.16.3.1
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> <span class="nb">set</span> remote as buat neighbor
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols bgp <span class="m">64512</span> neighbor <span class="m">172</span>.16.3.1 remote-as <span class="m">65000</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> ini konfigurasi minimal buat peering bgp, kita commit dan seharunya bgp bisa running
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">exit</span>
<span class="gp">vyos@ROUTER2:~$</span>
</code></pre></div>


<p>Di router peer nya, kalau belum di set, konfigurasinya sama dengan konfig di
atas, tinggal disesuaikan address, as number sama neighbor nya.</p>
<p>Di router VyOS, Vyatta dan keluarganya, cek status bgp bisa pakai <code>show ip bgp summary</code> atau bisa
juga cek neighbor <code>show ip bgp neigh 172.16.3.1</code></p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2:~$</span> show ip bgp neighbors <span class="m">172</span>.16.3.1
<span class="go">BGP neighbor is 172.16.3.1, remote AS 65000, local AS 64512, external link</span>
<span class="go">  BGP version 4, remote router ID 172.16.3.1</span>
<span class="go">  BGP state = Established, up for 00:02:05</span>
<span class="go">  Last read 00:00:09, hold time is 180, keepalive interval is 60 seconds</span>
<span class="go">  Neighbor capabilities:</span>
<span class="go">    4 Byte AS: advertised and received</span>
<span class="go">    Route refresh: advertised and received(old &amp; new)</span>
<span class="go">    Address family IPv4 Unicast: advertised and received</span>
<span class="go">    Graceful Restart Capabilty: received</span>
<span class="go">      Remote Restart timer is 120 seconds</span>
<span class="go">      Address families by peer:</span>
<span class="go">        IPv4 Unicast(not preserved)</span>
<span class="go">  Graceful restart informations:</span>
<span class="go">    End-of-RIB send: IPv4 Unicast</span>
<span class="go">    End-of-RIB received: IPv4 Unicast</span>
<span class="go">  Message statistics:</span>
<span class="go">    Inq depth is 0</span>
<span class="go">    Outq depth is 0</span>
</code></pre></div>


<p><code>BGP state = Established</code>, berarti bgp sudah running.</p>
<p>&nbsp;</p>
<h4 id="bgp-advertisement">BGP Advertisement</h4>
<p>Setelah bgp peering bisa established, konfigurasi belum selesai. Kita advertise
atau umumkan ke tetangga bgp kita kalau kita punya prefix sekian dan sekian.</p>
<p>Secara default, bgp cuma meng-advertise prefix yang juga bgp. Artinya kalau
misal kita punya beberapa peering bgp, prefix yang kita terima dari peer A
misalnya, prefix-prefix ini bakal di-advertise ke peer lain. Sedangkan tipe
routing lain seperti ospf, connected, dan static tidak di distribusikan ke bgp.</p>
<p>Praktek umumnya, kita juga perlu meng-advertise prefix yang bukan bgp ke bgp.
Contoh saja misalnya kita punya static route di router kita yang kita mau prefix
static ini dimasukkan ke bgp buat di-advertise. Dan di protokol dynamic routing,
yang seperti ini disebut <em>route redistribution</em>.</p>
<p>Di contoh ini kita punya dua prefix, yang dua-duanya connected. Connected
artinya salah satu interface di router ini terhubung ke network prefix. Dua
prefix yang kita punya, 10.10.10.0/24 sama 192.168.1.0/24.</p>
<p>Bagaimana cara kita meng-advertise dua prefix connected di atas? di VyOS kita
cuma perlu set bgp dengan redistribute connected.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2:~$ #</span> cek prefix yang termasuk connected
<span class="gp">vyos@ROUTER2:~$</span> show ip route connected
<span class="go">Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,</span>
<span class="go">       I - ISIS, B - BGP, &gt; - selected route, * - FIB route</span>

<span class="go">C&gt;* 10.10.10.0/24 is directly connected, lo</span>
<span class="go">C&gt;* 127.0.0.0/8 is directly connected, lo</span>
<span class="go">C&gt;* 172.16.3.0/30 is directly connected, eth0</span>
<span class="go">C&gt;* 192.168.1.0/24 is directly connected, lo</span>
<span class="gp">vyos@ROUTER2:~$</span>
<span class="gp">vyos@ROUTER2:~$ #</span> cek advertise prefix awalnya kosong karena tidak ada
<span class="gp">vyos@ROUTER2:~$ #</span> bgp lain, juga tidak ada protocol lain yang di redistribute
<span class="gp">vyos@ROUTER2:~$</span>
<span class="gp">vyos@ROUTER2:~$</span> show ip bgp neighbors <span class="m">172</span>.16.3.1 advertised-routes
<span class="gp">vyos@ROUTER2:~$</span>
<span class="gp">vyos@ROUTER2:~$</span> configure
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols bgp <span class="m">64512</span> redistribute connected
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> save
<span class="go">Saving configuration to &#39;/config/config.boot&#39;...</span>
<span class="go">Done</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">exit</span>
<span class="gp">vyos@ROUTER2:~$ #</span> kita perlu refresh bgp advertisement
<span class="gp">vyos@ROUTER2:~$</span>
<span class="gp">vyos@ROUTER2:~$</span> reset ip bgp <span class="m">172</span>.16.3.1 out
<span class="gp">vyos@ROUTER2:~$</span> show ip bgp neighbors <span class="m">172</span>.16.3.1 advertised-routes
<span class="go">BGP table version is 0, local router ID is 172.16.3.2</span>
<span class="go">Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal,</span>
<span class="go">              r RIB-failure, S Stale, R Removed</span>
<span class="go">Origin codes: i - IGP, e - EGP, ? - incomplete</span>

<span class="go">   Network          Next Hop            Metric LocPrf Weight Path</span>
<span class="go">*&gt; 10.10.10.0/24    172.16.3.2               1         32768 ?</span>
<span class="go">*&gt; 172.16.3.0/30    172.16.3.2               1         32768 ?</span>
<span class="go">*&gt; 192.168.1.0/24   172.16.3.2               1         32768 ?</span>

<span class="go">Total number of prefixes 3</span>
<span class="gp">vyos@ROUTER2:~$</span>
</code></pre></div>


<p>Begitu kita distribusikan protokol connected, maka prefix yang masuk tipe
connected di-import ke bgp kemudian di-advertise ke peer 172.16.3.1</p>
<p>&nbsp;</p>
<h4 id="prefix-filter">Prefix filter</h4>
<p>Seperti terlihat di atas, ada tiga prefix connected yang di advertise ke peer
bgp 172.16.3.1.
Umumnya kita tidak mau advertise semua prefix yang kita punya, contoh di atas
itu ada prefix 172.16.3.0/30, prefix ini dipakai buat koneksi inter-router antar
peer bgp, kita tidak mau prefix ini ikut di-advertise ke bgp neighbor.</p>
<p>Di VyOS, ada dua cara filter prefix yang nantinya di-advertise ke peer. Pertama,
kita bisa filter waktu import prefix dari protokol lain, connected misalnya.
Kedua, kita filter di bgp advertisement.</p>
<p>Maksudnya begini, jadi di kasus ini kita punya dua prefix connected yang mau
kita advertise ke peer bgp 172.16.3.1. Nah, prosesnya pertama dua prefix ini
diimport dari connected ke bgp, setelah itu baru di advertise ke peer bgp.
Nah kita bisa filter waktu import dari connected, atau filter prefix waktu
advertise ke peer bgp.
Kita bisa filter waktu prefix ini masuk bgp, jadi di internal bgp prefix sudah
tersaring. Atau kita bisa import prefix semuanya ke bgp tanpa filter, kemudian
waktu advertise ke peer baru difilter.</p>
<p>Saya secara pribadi prefer filter di advertisement. Karena filter import kita
perlu filter masing-masing protokol non bgp, misalnya ada filter untuk
connected, filter buat static, filter buat ospf, dst.
Kalau filter advertisement, maka cukup satu rule filter saja.</p>
<p>Kemudian filter prefix ke peer bgp ini harus ada supaya tidak ada route leak.
Misal saja kalau di bgp multihoming antar isp, biasanya bgp punya peer ke banyak
upstream, misal saja Indosat sama Telkom.</p>
<p>Seperti yang saya sebutkan di atas, bgp secara default meng-advertise semua
prefix yang diterima dari bgp lain. Nah kita tidak mau misalnya prefix yang
kita terima dari Indosat kita advertise lagi ke Telkom, begitu juga sebaliknya.
Kecuali kalau kita jadi penyedia jasa ip transit, tapi bukan itu yang kita bahas
di sini.</p>
<p>Di sini kita coba filter prefix 172.16.3.0/30 supaya tidak di-advertise ke peer
172.16.3.1.</p>
<p>Langkah-langkah nya ada tiga:</p>
<ul>
<li>Buat prefix list, kita kasih nama <code>LIST-ALLOW-PREFIX</code>. List ini isinya semua
  prefix yang nantinya di-advertise ke peer bgp</li>
<li>Buat route-map, nama route-map nya <code>BGP-EXPORT</code>. Di route-map ini rule nya,
  pertama kita allow yang di prefix-list <code>LIST-ALLOW-PREFIX</code>, kemudian prefix
  lainnya yang tidak ada di list di drop.</li>
<li>Ketiga, route-map yang sudah dibuat di set ke peer 172.16.3.1 untuk export.
  route-map export dipakai buat filter prefix yang kita advertise ke peer, kalau
  route-map import dipakai buat filter prefix yang diterima dari 172.16.3.1.</li>
</ul>
<p>Pertama, buat prefix list yang isinya prefix yang mau di-advertise. Ada dua
prefix-nya 192.168.1.0/24 sama 10.10.10.0/24</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2:~$</span> configure
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy prefix-list LIST-ALLOW-PREFIX rule <span class="m">10</span> action permit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy prefix-list LIST-ALLOW-PREFIX rule <span class="m">10</span> prefix <span class="m">192</span>.168.1.0/24
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy prefix-list LIST-ALLOW-PREFIX rule <span class="m">11</span> action permit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy prefix-list LIST-ALLOW-PREFIX rule <span class="m">11</span> prefix <span class="m">10</span>.10.10.0/24
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> show policy prefix-list LIST-ALLOW-PREFIX
<span class="go"> rule 10 {</span>
<span class="go">     action permit</span>
<span class="go">     prefix 192.168.1.0/24</span>
<span class="go"> }</span>
<span class="go"> rule 11 {</span>
<span class="go">     action permit</span>
<span class="go">     prefix 10.10.10.0/24</span>
<span class="go"> }</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Kedua, buat route-map yang isinya rule terima prefix dari prefix-list di atas,
kemudian drop prefix yang tidak ada di list.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy route-map BGP-EXPORT rule <span class="m">10</span> action permit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy route-map BGP-EXPORT rule <span class="m">10</span> match ip address prefix-list LIST-ALLOW-PREFIX
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> policy route-map BGP-EXPORT rule <span class="m">50</span> action deny
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> show policy route-map
<span class="go"> route-map BGP-EXPORT {</span>
<span class="go">     rule 10 {</span>
<span class="go">         action permit</span>
<span class="go">         match {</span>
<span class="go">             ip {</span>
<span class="go">                 address {</span>
<span class="go">                     prefix-list LIST-ALLOW-PREFIX</span>
<span class="go">                 }</span>
<span class="go">             }</span>
<span class="go">         }</span>
<span class="go">     }</span>
<span class="go">     rule 50 {</span>
<span class="go">         action deny</span>
<span class="go">     }</span>
<span class="go"> }</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Ketiga, setelah rule di route-map BGP-EXPORT kita set ke peer</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols bgp <span class="m">64512</span> neighbor <span class="m">172</span>.16.3.1 route-map <span class="nb">export</span> BGP-EXPORT
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> save
<span class="go">Saving configuration to &#39;/config/config.boot&#39;...</span>
<span class="go">Done</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> refresh bgp untuk out advertisement supaya pakai rule baru
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> run reset ip bgp <span class="m">172</span>.16.3.1 out
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2# ##</span> cek prefix yang di advertise
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> run sh ip bgp neigh <span class="m">172</span>.16.3.1 adv
<span class="go">BGP table version is 0, local router ID is 172.16.3.2</span>
<span class="go">Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal,</span>
<span class="go">              r RIB-failure, S Stale, R Removed</span>
<span class="go">Origin codes: i - IGP, e - EGP, ? - incomplete</span>

<span class="go">   Network          Next Hop            Metric LocPrf Weight Path</span>
<span class="go">*&gt; 10.10.10.0/24    172.16.3.2               1         32768 ?</span>
<span class="go">*&gt; 192.168.1.0/24   172.16.3.2               1         32768 ?</span>

<span class="go">Total number of prefixes 2</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Berhasil, cuma prefix yang ada di list LIST-ALLOW-PREFIX yang di advertise ke
172.16.3.1</p>
<p>Bagaimana dengan <em>route-map import?</em> <em>route-map import</em> kita pakai kalau kita perlu
filter atau modifikasi atribut routing yang kita terima dari peer bgp.</p>
<p>Ada banyak yang bisa kita buat di route-map. Di bgp multihoming misalnya, contoh
saja kita punya dua peer bgp, dua-duanya meng-advertise ke bgp kita prefix yang
sama, anggap saja prefix Google 8.8.8.0/24.</p>
<p>Kita mau traffic ke network Google ini lewat peer A, kita bisa buat prefix-list
yang isinya 8.8.8.0/24, kemudian kita buat rule di route-map buat modifikasi
atribut localpref ke angka yang lebih besar dari default, kemudian route-map
ini kita set ke neighbor A untuk import.</p>
<p>Jadi fungsi route-map bukan cuma buat filter prefix, tapi juga bisa buat
modifikasi atribut routing bgp. Silakan bereksperimen dengan route-map.</p>
<p>&nbsp;</p>
<h3 id="ospf-open-shortest-path-first">OSPF (Open Shortest Path First)</h3>
<p>Dynamic protocol berikutnya, OSPF. OSPF masuk dalam kategori <em>Interior Gateway
Protocol</em> atau <strong>IGP</strong>, kategori lainnya <strong>EGP</strong> atau <em>Exterior Gateway Protocol</em>, BGP di
atas masuk kategori EGP. IGP artinya protokol ini cuma hidup dan berjalan di
satu lingkup AS saja, bukan seperti BGP di atas yang bisa nyeberang antar AS.
Karena itu OSPF cuma dipakai internal saja dalam satu Autonous System.</p>
<p>Kemudian OSPF ini tipe protokolnya link-state routing protocol. Yang artinya,
apa yang diumumkan atau di advertise ke tetangga ospf bukan routing
tapi kondisi terkini link router.</p>
<p>Jadi cara kerjanya ospf seperti ini, masing-masing router ospf punya database
yang namanya link state database.
Kondisi link interface, berapa bandwidth link itu, ada yang
100 Mbps ada yang 1 Gbps, network nya di link itu apa saja, semuanya
disimpan di link state database atau <strong>lsdb</strong>. Nah, kondisi terkini link
router ini di advertise ke semua tetangga ospf, proses pengumuman atau
advertising ini di ospf namanya <em>Link State Advertisement</em> atau <strong>LSA</strong>. Jadi
setiap router yang terkoneksi ospf saling kirim LSA yang pada akhirnya,
masing-masing router ospf punya database LSDB yang identik, dan LSDB
inilah gambaran topologi jaringan OSPF.</p>
<p>Misal ada 10 router ospf yang saling terhubung, kesepuluh router ini punya
gambaran lsdb yang sama. Waktu ada salah satu router mengalami perubahan kondisi
link, anggap saja link nya down, maka perubahan ini di-broadcast ke semua
neighbor atau tetangga ospf. Jadi kalau router pertama ada link yang down,
router kesepuluh bakal tau.</p>
<p>Selanjutnya dari gambaran topologi yang ada di LSDB ini, masing-masing router
secara independen malakukan kalkulasi jalur routing.</p>
<p>Buat memperjelas gambaran Link-State protocol ini dengan yang lain seperti
distance vector, bayangkan teman-teman ada di sebuah kota yang belum pernah
ke situ sebelumnya, jadi jalan-jalan di situ asing. Anggap sekarang ada di titik
A mau menuju ke titik B. Untuk yang non link-state, maka teman-teman tinggal
jalan saja ikuti petujuk jalan, kalau ketemu simpangan terus ada tanda ke arah B
belok kanan, maka belok kanan, tandanya ke kiri maka ikuti ke kiri. Kalau ikuti
terus petunjuk jalan ini, nanti pada akhirnya sampai di titik B.</p>
<p>Kalau untuk link-state protocol, beda. Link state protocol kita pegang map atau
peta, jadi dari awal kita sudah tau gambaran jalan-jalannya, di mana posisi kita
sekarang dan di mana posisi titik B. Dari map ini kita bisa hitung lewat mana
sih jalan yang tercepat kalau mau ke titik B, jadi tidak perlu ikuti petunjuk
jalan. Kalau ada gang-gang kecil tapi lewat situ lebih cepat, bisa lewat situ.</p>
<p>Kira-kira seperti itu apa yang dilihat oleh router ospf, jadi masing-masing
punya map di lsdb yang setiap router map nya sama, dari map ini masing-masing
router secara independen menghitung jarak terpendek menuju tujuan. Pakai map
lsdb ini maka jaringan bebas loop, ingat looping di atas yang cuma bolak-balik
tidak bisa sampai tujuan, kondisi looping ini tidak bisa terjadi di ospf karena
jalurnya sudah dihitung berdasarkan gambaran topologi lsdb.</p>
<p>Bayangkan kalau pakai non link-state seperti di atas yang kita cuma ikuti
petunjuk jalan. Kita cuma tau belok kiri, belok kanan atau lurus. Kemudian setelah
beberapa belokan ternyata kita sampai di simpangan yang sebelumnya sudah
dilewati, akhirnya cuma berputar-putar di situ-situ saja tidak bisa sampai
tujuan. Karena setelah diperiksa ternyata petunjuk jalannya salah pasang, dan di
dunia routing hal itu juga bisa saja terjadi.</p>
<p>Sampai sini kita sudah paham bahwa OSPF masuk kategori IGP yang cuma beroperasi
dalam satu lingkup Autonomous System. Kemudian OSPF adalah salah satu tipe link
state routing protocol.</p>
<p>Sebelum kita lanjut, saya informasikan kalau ospf ini detail teknisnya agak rumit
dan saya tidak bahas ospf sampai detail karena sepertinya butuh bab sendiri buat
ospf dan bakal panjang dan membosankan.</p>
<p>Di sini saya cuma usahakan bagaimana ospf bisa up dan running tanpa tau detail
bagaimana ospf itu kerjanya. Anggap seperti orang yang belajar nyetir mobil, dia
tidak perlu tau detail bagaimana cara kerja mesin.</p>
<p>Minimalnya kalau mau buat jaringan OSPF, paling tidak ada dua informasi yang
perlu kita tau; Area sama Network.</p>
<p><strong>Area</strong>. Area di ospf fungsinya segmentasi logis router. Jadi ada sekelompok
router di area A, ada lagi sekelompok router di area B, dan seterusnya.</p>
<p>Bayangkan kalau misalnya kita punya 100 router yang terkoneksi ospf di satu
area, ukuran lsdb pasti bengkak, terus kalau salah satu router mengalami perubahan
link state, maka LSA akan membanjiri jaringan.</p>
<p>Di sini fungsi area, kita bisa secara logis mengelompokkan router-router ke
beberapa area terpisah. Dengan pengelompokan area ini, router ospf cuma
me-maintain lsdb di area yang sama. Artinya router-router ini cuma tau topologi
di areanya saja, topologi di area lain tidak kelihatan.</p>
<p>Ada beberapa tipe area di ospf, di sini dua saja yang akan saya bahas. Pertama
standard area, dan kedua stub area. Area di ospf ditulis seperti format ip
address, misal 0.0.0.0 atau 192.168.1.0, dst.</p>
<p>Ada satu standard area yang wajib ada di ospf, namanya area backbone atau area 0.
Area backbone bisa ditulis pakai 0.0.0.0 atau cukup 0. Semua area selain
backbone harus terkoneksi ke area ini.</p>
<p>Area yang satu lagi namanya stub area. Tipe area ini area tertutup, artinya
jalan keluar masuk area ini cuma lewat satu pintu saja, satu router.
Jadi di area stub ini ada satu router yang fungsinya jadi gateway ke network di
luar area, router ini disebut ABR atau Area Border Router.</p>
<p>Fungsi router ABR ini meng-inject default route ke area stub, jadi nantinya
semua router di area stub ini punya entri routing default route 0.0.0.0/0 yang
gateway-nya router ABR.</p>
<p>Jadi di area stub ini tidak semua routing ospf ada, cuma ada routing intra-area
atau routing di area stub ini saja, plus satu routing untuk default gateway
lewat router ABR. Karena itu traffic LSA di area ini tidak besar, jadinya ukuran
lsdb juga kecil.</p>
<p>Karena ukuran lsdb-nya yang kecil, tipe area ini cocok buat router-router kecil
yang tidak punya memori besar.</p>
<div class="aimg">
    <img src="//devnull.web.id/images/networking/ip_route/ospf_area.png" alt="OSPF Area" title="OSPF Area" />
</div>

<p>Jadi kapan kita pakai area stub? Pertimbangannya, kalau area ini area jalan
buntu, keluar masuk area cuma ada satu jalan saja, lewat router ABR. Kedua,
kalau router-router di area ini router kecil yang cuma perlu default route.</p>
<p><strong>Network</strong>. Di dalam area ospf, apakah itu standard area atau stub area, di
dalam area ini ada network nya, misal network 10.10.10.0/24 masuk area backbone,
dan network 192.168.1.0/24 masuk area 192.168.1.0 yang tipe areanya stub. Di
dalam satu area bisa ada lebih dari satu network.</p>
<p>Misal kalau kita set network 10.10.10.0/24 ke area backbone, maka ospf bakal cek
interface router yang mana saja yang masuk ke network 10.10.10.0/24. Kalau
misalnya interface eth0 ada ip address 10.10.10.1 maka eth0 dimasukkan ke ospf
dan ospf mulai mem-broadcast LSA lewat eth0.</p>
<p>Ospf membentuk adjacency kalau router ada deteksi router ospf lain yang punya
network sama dan ada di area yang sama.
Jadi kalau ada dua atau lebih router ospf di satu broadcast domain, punya
network yang sama dan network ini ada di area yang sama maka bakal terbentuk
adjcency antar router ospf yang saling bertetangga. Kalau sudah terbentuk
adjacency, router bisa saling broadcast LSA masing-masing.</p>
<p>&nbsp;</p>
<h4 id="route-redistribution">Route redistribution</h4>
<p>Seperti juga bgp di atas, kita juga bisa import routing dari protokol lain ke
ospf supaya router yang lain tau jalur ke prefix ini.</p>
<p>&nbsp;</p>
<h4 id="konfigurasi-ospf">Konfigurasi OSPF</h4>
<p>Kita pakai lagi router untuk setting bgp di atas buat ospf. Jadi router1 ip
addressnya 172.16.3.1/30 dan router router2 172.16.3.2/30.
Router2 punya dua prefix connected, 10.10.10.0/24 sama 192.168.1.0/24 yang dua
prefix connected ini nantinya kita inject ke ospf.</p>
<p>Router1 dan router2 terkoneksi satu broadcast domain di network 172.16.3.0/30.
Network ini yang kita pakai dan set ke area 0 atau area backbone.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER1:~$</span> configure
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER1#</span> <span class="nb">set</span> protocols ospf area <span class="m">0</span> network <span class="m">172</span>.16.3.0/30
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER1#</span> show protocols ospf
<span class="go">+area 0 {</span>
<span class="go">+    network 172.16.3.0/30</span>
<span class="go">+}</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER1#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER1#</span> save
<span class="go">Saving configuration to &#39;/config/config.boot&#39;...</span>
<span class="go">Done</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER1#</span>
</code></pre></div>


<p>Router1 sudah terset, tinggal router2.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2:~$</span> configure
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols ospf area <span class="m">0</span> network <span class="m">172</span>.16.3.0/30
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Kalau sudah berhasil terbentuk adjacency, kita bisa lihat detail tetangga ospf
kita.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2#</span> run show ip ospf neighbor

<span class="go">    Neighbor ID Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL</span>
<span class="go">172.16.3.1        1 2-Way/DROther     34.366s 172.16.3.1      eth0:172.16.3.2          0     0     0</span>
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Berhasil, neighbor 172.16.3.1 terbaca dari router2.
Di salah satu router ospf kita bisa cek routing ospf pakai command <code>show ip
route ospf</code></p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER1:~$</span> show ip route ospf
<span class="go">Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,</span>
<span class="go">       I - ISIS, B - BGP, &gt; - selected route, * - FIB route</span>

<span class="go">O   172.16.3.0/30 [110/10] is directly connected, eth1, 00:08:32</span>
<span class="gp">vyos@ROUTER1:~$</span>
</code></pre></div>


<p>Cuma ada satu prefix 172.16.3.0/30.
Berikutnya di router2 kita coba import prefix connected ke ospf.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER2#</span> <span class="nb">set</span> protocols ospf redistribute connected
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span> commit
<span class="go">[edit]</span>
<span class="gp">vyos@ROUTER2#</span>
</code></pre></div>


<p>Cek lagi di router1, apa sudah ada prefix yang diimport.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">vyos@ROUTER1:~$</span> show ip route ospf
<span class="go">Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,</span>
<span class="go">       I - ISIS, B - BGP, &gt; - selected route, * - FIB route</span>

<span class="go">O   10.10.10.0/24 [110/20] via 172.16.3.2, 00:00:03</span>
<span class="go">O   172.16.3.0/30 [110/10] is directly connected, eth1, 00:11:09</span>
<span class="go">O   192.168.1.0/24 [110/20] via 172.16.3.2, 00:00:03</span>
<span class="gp">vyos@ROUTER1:~$</span>
<span class="gp">vyos@ROUTER1:~$</span> ping <span class="m">10</span>.10.10.1
<span class="go">PING 10.10.10.1 (10.10.10.1) 56(84) bytes of data.</span>
<span class="go">64 bytes from 10.10.10.1: icmp_req=1 ttl=64 time=0.677 ms</span>
<span class="go">64 bytes from 10.10.10.1: icmp_req=2 ttl=64 time=1.13 ms</span>
<span class="go">^C</span>
<span class="go">--- 10.10.10.1 ping statistics ---</span>
<span class="go">2 packets transmitted, 2 received, 0% packet loss, time 1001ms</span>
<span class="go">rtt min/avg/max/mdev = 0.677/0.905/1.133/0.228 ms</span>
</code></pre></div>


<p>Prefix 10.10.10.0/24 sama 192.168.1.0/24 terbaca dari router1 dan gatewaynya
router2 yang address nya 172.16.3.2.</p>
<p>&nbsp;</p>
<p>Baik, saya rasa sudah cukup panjang dan saya cuma sampai di sini. Selanjutnya
silakan teman-teman lanjutkan sendiri eksperimen nya.</p>
<p>Kalau ada koreksi, saran, kritik atau komentar silakan disampaikan.</p>
<p>Terima kasih dan semoga bermanfaat.</p>
      </div>
        <br />
<section id="ending">
        <div id="share">
<!--    <p id="post-share-links"> -->
            Sebarkan artikel ini :<br /> 
                  <a href="http://twitter.com/home?status=b'Jaringan%20Layer%203%2C%20IP%20routing%20//devnull.web.id/networking/jaringan-layer-3.html'" target="_blank" title="Share on Twitter">
                        <img src="/images/social/twitter.png" />
                  </a>
                  <a href="http://www.facebook.com/sharer/sharer.php?u=//devnull.web.id/networking/jaringan-layer-3.html" target="_blank" title="Share on Facebook">
                        <img src="/images/social/facebook.png" />
                  </a>
                  <a href="https://plus.google.com/share?url=//devnull.web.id/networking/jaringan-layer-3.html" target="_blank" title="Share on Google Plus">
                        <img src="/images/social/google-plus.png" />
                  </a>
                  <a href="mailto:?subject=Jaringan%20Layer%203%2C%20IP%20routing&amp;body=//devnull.web.id/networking/jaringan-layer-3.html" target="_blank" title="Share via Email">
                        <img src="/images/social/email.png" />
                  </a>
        </div>
        <br />
</section>
      <footer class="post-footer">
      <br />
      <hr />
<!--
      <div class="meta">
            Categories «<a href="//devnull.web.id/category/networking.html">Networking</a>» 
            by <a href="//devnull.web.id/author/dhani-setiawan.html">Dhani Setiawan</a><br />
            Mots-clés:         </div>
-->

        <form style="border:1px solid #ccc;padding:3px;text-align:center;" 
                action="https://feedburner.google.com/fb/a/mailverify" method="post" 
                target="popupwindow" onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=blog/devnull', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
                <p>Anda tidak perlu repot-repot mengunjungi blog ini.<br />
                Silahkan masukkan alamat email dan begitu ada post baru, Saya akan minta robot FeedBurner mengantarkannya ke email inbox Anda.</p>
                <p><input type="text" style="width:140px" name="email"/></p>
                <input type="hidden" value="blog/devnull" name="uri"/>
                <input type="hidden" name="loc" value="en_US"/>
                <input type="submit" value="Berlangganan" />
                <p>Delivered by <a href="https://feedburner.google.com" target="_blank">FeedBurner</a></p>
        </form>
        <br />
      </footer>

      <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'dhani-devnull'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="//disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </article> <!-- /#page-main -->

        <aside id="page-side">
          <!-- begin includes/sidebar.html -->
          <nav>
            <h3>Pages</h3>
            <ul>
<!--              <li><a href="//devnull.web.id">Accueil</a></li> -->
              <li><a href="//devnull.web.id/categories.html">Categories</a></li>
              <li><a href="//devnull.web.id/tags.html">Tags</a></li>
              <li><a href="//devnull.web.id/archives.html">Archives</a></li>
              <li><a href="//devnull.web.id/pages/about-me.html">About Me</a></li>
            </ul>
          </nav>

          <nav>
            <h3>Categories</h3>
            <ul>
              <li><a href="//devnull.web.id/category/debian.html">Debian</a></li>
              <li><a href="//devnull.web.id/category/esai.html">Esai</a></li>
              <li><a href="//devnull.web.id/category/how-to.html">How-to</a></li>
              <li><a href="//devnull.web.id/category/linux-padawan.html">Linux Padawan</a></li>
              <li><a href="//devnull.web.id/category/misc.html">Misc</a></li>
              <li class="active"><a href="//devnull.web.id/category/networking.html">Networking</a></li>
              <li><a href="//devnull.web.id/category/openstack.html">OpenStack</a></li>
              <li><a href="//devnull.web.id/category/programming.html">Programming</a></li>
            </ul>
          </nav>

          <nav>
            <h3>Links</h3>
            <ul>
<!--            
              <li><a href="//devnull.web.id/feed">Subscribe</a></li>
-->
                <li><a href="/pages/subscribe.html">Berlangganan artikel</a></li>
              <li><a href="https://github.com/dhanist" target="_blank">GitHub</a></li>
              <li><a href="https://plus.google.com/+DhaniSetiawanYoda" target="_blank">Google+</a></li>
              <li><a href="http://www.transkon.net.id" target="_blank">Transkon-Net</a></li>
              <li><a href="https://www.debian.org/" target="_blank">Debian</a></li>
              <li><a href="https://www.openstack.org" target="_blank">OpenStack</a></li>
            </ul>
          </nav>
          <!-- end includes/sidebar.html --></aside> <!-- /#page-side -->
      </div>  <!-- /#page-body -->

      <footer id="page-foot">
        <p> &copy; Dhani Setiawan. <a href="//devnull.web.id">devnull.web.id</a> is powered by <a href="http://getpelican.com" target="_blank">Pelican</a> and <a href="https://github.com/getpelican/pelican-themes/tree/master/dev-random2" target="_blank">dev-random2</a> theme</p>
      </footer>
    </div> <!-- /#page -->
  </body>
</html>